# ğŸ›ï¸ MariaDB Query Optimizer - Architecture Diagram

## ğŸ¯ High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚                           ğŸŒ PRESENTATION LAYER                             â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚                         Web Browser (Client)                           â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  HTML (index.html)                                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Form structure                                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Result containers                                            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Semantic markup                                              â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  CSS (style.css)                                                â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Dark theme with gradients                                    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Glass morphism effects                                       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Responsive design                                            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Animations & transitions                                     â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  JavaScript (script.js)                                         â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Event handling                                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - API communication                                            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Dynamic rendering                                            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Prism.js integration                                         â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  External Libraries                                             â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Prism.js (syntax highlighting)                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Font Awesome (icons)                                         â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Google Fonts (typography)                                    â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†•
                            HTTP/REST API (JSON)
                                      â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚                          ğŸš€ APPLICATION LAYER                               â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚                      FastAPI Application (main.py)                     â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  Route Handlers                                                 â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  GET  /              â†’ Serve frontend                           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  GET  /status        â†’ Health check                             â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  GET  /history       â†’ Get recent analyses                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  GET  /metrics       â†’ Usage statistics                         â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  POST /analyze       â†’ Full analysis (main endpoint)            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  POST /optimize      â†’ Query optimization only                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  POST /validate-query â†’ Validation only                         â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  POST /save-cost     â†’ Cost estimation only                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  POST /analyze-schema â†’ Schema analysis only                    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  Request/Response Models (Pydantic)                             â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  class QueryRequest(BaseModel):                                 â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      sql_query: str                                             â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  class SchemaRequest(BaseModel):                                â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      schema_sql: str                                            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  Middleware & Configuration                                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Static file serving (/static)                                â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - CORS (if needed)                                             â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Error handling                                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Logging                                                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  Helper Functions                                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  split_optimizer_output(raw_output: str)                        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â†’ Separates SQL from rationale                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†•
                          Direct Python Function Calls
                                      â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚                           ğŸ¤– BUSINESS LOGIC LAYER                           â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                          AI Agent Framework                            â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  BaseAgent (base_agent.py)                                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Anthropic client initialization                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - API key management                                           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Model configuration                                          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Shared error handling                                        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Properties:                                                    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ self.client: Anthropic                                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ self.model_name: str                                       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                    â†‘                                    â”‚ â”‚
â”‚  â”‚                                    â”‚ Inherits                           â”‚ â”‚
â”‚  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚ â”‚
â”‚  â”‚                    â”‚               â”‚               â”‚                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚  QueryOptimizer     â”‚  â”‚ DataValidator  â”‚  â”‚  CostSaver      â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  (query_optimizer.py)â”‚  â”‚(data_validator.py)â”‚(cost_saver.py)  â”‚    â”‚ â”‚
â”‚  â”‚  â”‚                     â”‚  â”‚                â”‚  â”‚                 â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  optimize_query()   â”‚  â”‚ validate_query()â”‚  â”‚ save_cost()     â”‚    â”‚ â”‚
â”‚  â”‚  â”‚                     â”‚  â”‚                â”‚  â”‚                 â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Detects SQL type â”‚  â”‚ â€¢ Syntax check â”‚  â”‚ â€¢ Cost analysis â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Builds prompt    â”‚  â”‚ â€¢ Security scanâ”‚  â”‚ â€¢ Savings tips  â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Calls Claude API â”‚  â”‚ â€¢ Compatibilityâ”‚  â”‚ â€¢ Performance   â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Returns optimizedâ”‚  â”‚ â€¢ Safety check â”‚  â”‚ â€¢ Index review  â”‚    â”‚ â”‚
â”‚  â”‚  â”‚                     â”‚  â”‚                â”‚  â”‚                 â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  Token limit: 1500  â”‚  â”‚ Token limit: 500â”‚ â”‚ Token limit: 500â”‚    â”‚ â”‚
â”‚  â”‚  â”‚                     â”‚  â”‚                â”‚  â”‚                 â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  SchemaAdvisor (schema_advisor.py)                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  analyze_schema()                                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Indexing recommendations                                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Data modeling suggestions                                    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Data type optimization                                       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ MariaDB compatibility                                        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Token limit: 500                                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†•
                              Anthropic API Calls
                                      â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚                          ğŸ§  EXTERNAL AI SERVICE                             â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚                    Anthropic Claude API                                â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  Model: claude-3-haiku-20240307                                 â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Capabilities:                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Natural language understanding                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ SQL query analysis                                           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Optimization recommendations                                 â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Context-aware suggestions                                    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Security analysis                                            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Performance estimation                                       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Request Format:                                                â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  {                                                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    "model": "claude-3-haiku-20240307",                          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    "max_tokens": 1500,                                          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    "temperature": 0,                                            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    "messages": [{"role": "user", "content": "..."}]            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  }                                                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Response Format:                                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  {                                                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    "content": [{"text": "Optimized SQL Query: ..."}]           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  }                                                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†•
                          Direct Python Function Calls
                                      â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚                           ğŸ’¾ DATA ACCESS LAYER                              â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚                    Utility Modules (utils/)                            â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  HistoryStore (history_store.py)                                â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Purpose: Persistent storage for analysis history               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Methods:                                                       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ append(payload: Dict) â†’ None                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      - Adds UTC timestamp                                       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      - Serializes to JSON                                       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      - Appends to JSONL file (thread-safe)                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ get_recent(limit: int = 20) â†’ List[Dict]                   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      - Reads JSONL file                                         â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      - Returns last N entries                                   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ metrics() â†’ Dict[str, Any]                                 â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      - Total entries count                                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      - First/last run timestamps                                â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Thread Safety:                                                 â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ Uses threading.Lock()                                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ Atomic file operations                                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  Config (config.py)                                             â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Purpose: Configuration management                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Functions:                                                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ get_connection() â†’ Connection                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ execute_query(query: str) â†’ Results                        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ execute_explain(query: str) â†’ Explain                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Configuration:                                                 â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ DB_HOST, DB_PORT, DB_USER, DB_PASS, DB_NAME               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ ANTHROPIC_API_KEY, CLAUDE_API_KEY                          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†•
                              File System Operations
                                      â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚                           ğŸ“ STORAGE LAYER                                  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚                      File System Storage                               â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  data/history.jsonl                                             â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Format: JSONL (JSON Lines)                                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - One JSON object per line                                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Append-only writes                                           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - No database required                                         â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Structure:                                                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  {                                                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    "timestamp": "2024-01-15T10:30:00Z",                         â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    "type": "analysis",                                          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    "request": {"sql_query": "..."},                            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    "response": {                                                â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      "original_query": "...",                                   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      "optimized_query": "...",                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      "optimization_rationale": "...",                           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      "validation_report": "...",                                â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      "cost_estimation": "...",                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      "schema_suggestions": "..."                                â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    }                                                            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  }                                                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Benefits:                                                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Simple and lightweight                                       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Human-readable                                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Easy to parse and analyze                                    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ No database setup required                                   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Append-only for data integrity                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Component Interaction Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. HTTP GET /
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FastAPI    â”‚â”€â”€â”€â”€â”€â”€â†’ Serve index.html, style.css, script.js
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. User enters SQL query
       â”‚ 3. Clicks "Analyze Query"
       â”‚
       â”‚ 4. HTTP POST /analyze
       â”‚    Body: {"sql_query": "SELECT ..."}
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FastAPI Router                        â”‚
â”‚                                                          â”‚
â”‚  1. Validate request (Pydantic)                          â”‚
â”‚  2. Check initialization status                          â”‚
â”‚  3. Route to agents                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 5. Call query_optimizer.optimize_query()
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              QueryOptimizer Agent                        â”‚
â”‚                                                          â”‚
â”‚  1. Detect SQL type (SELECT, INSERT, etc.)               â”‚
â”‚  2. Build optimization prompt                            â”‚
â”‚  3. Send to Claude API                                   â”‚
â”‚  4. Receive optimized query + rationale                  â”‚
â”‚  5. Return to FastAPI                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 6. Split output into query and rationale
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              split_optimizer_output()                    â”‚
â”‚                                                          â”‚
â”‚  1. Split on "Optimized SQL Query:" marker               â”‚
â”‚  2. Split on "Rationale:" marker                         â”‚
â”‚  3. Return (optimized_query, rationale)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 7. Parallel agent execution
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â†“                 â†“                 â†“                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚DataValidator â”‚  â”‚  CostSaver   â”‚  â”‚SchemaAdvisor â”‚  â”‚HistoryStore  â”‚
â”‚              â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚
â”‚validate_queryâ”‚  â”‚  save_cost   â”‚  â”‚analyze_schemaâ”‚  â”‚   append     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                 â”‚                 â”‚                 â”‚
       â”‚ 8. All agents complete                             â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ 9. Aggregate results
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Response Aggregation                        â”‚
â”‚                                                          â”‚
â”‚  response_payload = {                                    â”‚
â”‚    "original_query": "...",                              â”‚
â”‚    "optimized_query": "...",                             â”‚
â”‚    "optimization_rationale": "...",                      â”‚
â”‚    "validation_report": "...",                           â”‚
â”‚    "cost_estimation": "...",                             â”‚
â”‚    "schema_suggestions": "..."                           â”‚
â”‚  }                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 10. Return JSON response
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 11. Parse JSON
       â”‚ 12. Format SQL with Prism.js
       â”‚ 13. Create visual diagrams
       â”‚ 14. Render results
       â”‚ 15. Apply syntax highlighting
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User views   â”‚
â”‚   results    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Agent Workflow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    QueryOptimizer Workflow                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Input: SQL Query
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Detect Statement Type                                  â”‚
â”‚                                                                 â”‚
â”‚ sql_upper = sql_query.strip().upper()                          â”‚
â”‚                                                                 â”‚
â”‚ if sql_upper.startswith('SELECT'):                             â”‚
â”‚     statement_type = 'SELECT'                                  â”‚
â”‚ elif sql_upper.startswith('INSERT'):                           â”‚
â”‚     statement_type = 'INSERT'                                  â”‚
â”‚ elif sql_upper.startswith('UPDATE'):                           â”‚
â”‚     statement_type = 'UPDATE'                                  â”‚
â”‚ elif sql_upper.startswith('DELETE'):                           â”‚
â”‚     statement_type = 'DELETE'                                  â”‚
â”‚ elif sql_upper.startswith('CREATE TABLE'):                     â”‚
â”‚     statement_type = 'CREATE TABLE'                            â”‚
â”‚ elif sql_upper.startswith('ALTER TABLE'):                      â”‚
â”‚     statement_type = 'ALTER TABLE'                             â”‚
â”‚ elif sql_upper.startswith('CREATE INDEX'):                     â”‚
â”‚     statement_type = 'CREATE INDEX'                            â”‚
â”‚ else:                                                           â”‚
â”‚     statement_type = 'UNKNOWN'                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Build Optimization Prompt                              â”‚
â”‚                                                                 â”‚
â”‚ prompt = f"""                                                   â”‚
â”‚ You are a MariaDB optimization expert.                         â”‚
â”‚                                                                 â”‚
â”‚ CRITICAL RULES:                                                â”‚
â”‚ 1. PRESERVE STATEMENT TYPE                                     â”‚
â”‚ 2. DO NOT CHANGE STATEMENT TYPE                                â”‚
â”‚ 3. PRESERVE SEMANTICS - ABSOLUTELY CRITICAL                    â”‚
â”‚ 4. AGGRESSIVE OPTIMIZATION                                     â”‚
â”‚ 5. MARIADB COMPATIBILITY                                       â”‚
â”‚                                                                 â”‚
â”‚ Statement Type: {statement_type}                               â”‚
â”‚                                                                 â”‚
â”‚ [Type-specific optimization guidelines]                        â”‚
â”‚                                                                 â”‚
â”‚ MANDATORY PRE-OPTIMIZATION CHECK:                              â”‚
â”‚ 1. Multiple subqueries in SELECT?                              â”‚
â”‚ 2. Same table(s) with similar logic?                           â”‚
â”‚ 3. If YES, MUST combine them                                   â”‚
â”‚ 4. Are they CORRELATED? Use window functions                   â”‚
â”‚ 5. VERIFY: Same results as original?                           â”‚
â”‚                                                                 â”‚
â”‚ Input SQL: {sql_query}                                         â”‚
â”‚                                                                 â”‚
â”‚ Respond with:                                                  â”‚
â”‚ Optimized SQL Query:                                           â”‚
â”‚ <optimized statement>                                          â”‚
â”‚                                                                 â”‚
â”‚ Rationale:                                                     â”‚
â”‚ - <SPECIFIC optimization>                                      â”‚
â”‚ - <QUANTIFIED impact>                                          â”‚
â”‚ - <Technical explanation>                                      â”‚
â”‚ """                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Send to Claude API                                     â”‚
â”‚                                                                 â”‚
â”‚ response = self.client.messages.create(                        â”‚
â”‚     model=self.model_name,                                     â”‚
â”‚     max_tokens=1500,  # For SELECT queries                     â”‚
â”‚     temperature=0,                                             â”‚
â”‚     system="You are a world-class MariaDB query optimizer.",   â”‚
â”‚     messages=[{"role": "user", "content": prompt}]             â”‚
â”‚ )                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Claude AI Processing                                   â”‚
â”‚                                                                 â”‚
â”‚ â€¢ Analyzes query structure                                     â”‚
â”‚ â€¢ Detects duplicate subqueries                                 â”‚
â”‚ â€¢ Identifies correlation patterns                              â”‚
â”‚ â€¢ Applies window function optimization                         â”‚
â”‚ â€¢ Verifies semantic equivalence                                â”‚
â”‚ â€¢ Calculates performance impact                                â”‚
â”‚ â€¢ Generates optimized query                                    â”‚
â”‚ â€¢ Writes detailed rationale                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Return Response                                        â”‚
â”‚                                                                 â”‚
â”‚ return response.content[0].text.strip()                        â”‚
â”‚                                                                 â”‚
â”‚ Format:                                                        â”‚
â”‚ "Optimized SQL Query:                                          â”‚
â”‚  SELECT ...                                                    â”‚
â”‚                                                                 â”‚
â”‚  Rationale:                                                    â”‚
â”‚  - Combined 2 duplicate subqueries                             â”‚
â”‚  - Reduces executions from 2N to N                             â”‚
â”‚  - Uses window functions"                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Output: Optimized Query + Rationale
```

---

## ğŸ“Š Data Flow Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Request Data Flow                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Input (Textarea)
    â†“
JavaScript (script.js)
    â†“ JSON.stringify()
{
  "sql_query": "SELECT c.name, (SELECT ...), (SELECT ...) FROM customers c"
}
    â†“ fetch("/analyze", {method: "POST", body: ...})
HTTP POST Request
    â†“
FastAPI (main.py)
    â†“ Pydantic validation
QueryRequest(sql_query="SELECT ...")
    â†“
QueryOptimizer.optimize_query(sql_query)
    â†“
Claude API Request
{
  "model": "claude-3-haiku-20240307",
  "max_tokens": 1500,
  "messages": [{"role": "user", "content": "You are a MariaDB..."}]
}
    â†“
Claude API Response
{
  "content": [{"text": "Optimized SQL Query: SELECT ... Rationale: ..."}]
}
    â†“
split_optimizer_output(raw_output)
    â†“
(optimized_query, rationale)
    â†“
Parallel Agent Execution
    â”œâ”€ DataValidator.validate_query()
    â”œâ”€ CostSaver.save_cost()
    â””â”€ SchemaAdvisor.analyze_schema()
    â†“
Response Aggregation
{
  "original_query": "...",
  "optimized_query": "...",
  "optimization_rationale": "...",
  "validation_report": "...",
  "cost_estimation": "...",
  "schema_suggestions": "..."
}
    â†“
HistoryStore.append(payload)
    â†“
data/history.jsonl
{"timestamp": "2024-01-15T10:30:00Z", "type": "analysis", ...}
    â†“
HTTP Response (JSON)
    â†“
JavaScript (script.js)
    â†“ JSON.parse()
    â†“ formatSQLBlock(), createQueryComparisonDiagram(), etc.
    â†“ Prism.highlightAll()
DOM Update (HTML)
    â†“
User Views Results
```

---

## ğŸ” Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Security Layers                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 1: Environment Protection
    â”œâ”€ API keys stored in .env file
    â”œâ”€ .env excluded from version control (.gitignore)
    â”œâ”€ Environment variables loaded at runtime
    â””â”€ No hardcoded secrets in source code

Layer 2: Input Validation
    â”œâ”€ Frontend: Required field validation
    â”œâ”€ Backend: Pydantic schema validation
    â”œâ”€ Type checking (sql_query: str)
    â””â”€ Automatic sanitization

Layer 3: Safe Query Analysis
    â”œâ”€ Queries are analyzed, NOT executed
    â”œâ”€ No direct database connection from user input
    â”œâ”€ Static analysis only
    â””â”€ No eval() or exec() calls

Layer 4: AI Security Checks
    â”œâ”€ DataValidator agent scans for:
    â”‚   â”œâ”€ SQL injection patterns
    â”‚   â”œâ”€ Unsafe operations
    â”‚   â”œâ”€ Missing WHERE clauses
    â”‚   â””â”€ Security vulnerabilities
    â””â”€ Recommendations for safer alternatives

Layer 5: Output Sanitization
    â”œâ”€ HTML escaping (escapeText function)
    â”œâ”€ No innerHTML with user data
    â”œâ”€ Prism.js handles code rendering safely
    â””â”€ No XSS vulnerabilities

Layer 6: API Rate Limiting (Future)
    â”œâ”€ Prevent abuse
    â”œâ”€ Protect Claude API quota
    â””â”€ Implement request throttling
```

---

## ğŸ¨ Frontend Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Frontend Component Tree                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

index.html (Root)
â”‚
â”œâ”€ <head>
â”‚  â”œâ”€ Meta tags (charset, viewport)
â”‚  â”œâ”€ <title>
â”‚  â”œâ”€ <link> style.css
â”‚  â”œâ”€ <link> Font Awesome CDN
â”‚  â”œâ”€ <link> Google Fonts (Inter, JetBrains Mono)
â”‚  â”œâ”€ <link> Prism.js CSS (prism-tomorrow theme)
â”‚  â””â”€ <link> Prism.js line-numbers plugin CSS
â”‚
â””â”€ <body>
   â”‚
   â”œâ”€ .header
   â”‚  â”œâ”€ .header-content
   â”‚  â”‚  â”œâ”€ .logo
   â”‚  â”‚  â”‚  â”œâ”€ <i class="fas fa-database">
   â”‚  â”‚  â”‚  â””â”€ <h1>MariaDB Query Optimizer</h1>
   â”‚  â”‚  â””â”€ <p class="subtitle">
   â”‚
   â”œâ”€ .container
   â”‚  â”‚
   â”‚  â”œâ”€ .input-section
   â”‚  â”‚  â”œâ”€ .section-header
   â”‚  â”‚  â”‚  â”œâ”€ <i class="fas fa-code">
   â”‚  â”‚  â”‚  â””â”€ <h2>SQL Query Input</h2>
   â”‚  â”‚  â””â”€ <form id="queryForm">
   â”‚  â”‚     â”œâ”€ .textarea-wrapper
   â”‚  â”‚     â”‚  â”œâ”€ <textarea id="query">
   â”‚  â”‚     â”‚  â””â”€ .textarea-footer
   â”‚  â”‚     â”‚     â””â”€ <span class="hint">
   â”‚  â”‚     â””â”€ <button type="submit" class="analyze-btn">
   â”‚  â”‚
   â”‚  â””â”€ <div id="result" class="results">
   â”‚     â”‚ (Dynamically populated by JavaScript)
   â”‚     â”‚
   â”‚     â”œâ”€ .results__section (Query Comparison)
   â”‚     â”‚  â”œâ”€ .results__section-header
   â”‚     â”‚  â”œâ”€ .visual-comparison
   â”‚     â”‚  â”‚  â””â”€ .comparison-cards
   â”‚     â”‚  â”‚     â”œâ”€ .comparison-card--before
   â”‚     â”‚  â”‚     â”œâ”€ .comparison-arrow
   â”‚     â”‚  â”‚     â””â”€ .comparison-card--after
   â”‚     â”‚  â”œâ”€ .sql-header
   â”‚     â”‚  â”‚  â”œâ”€ <h3>Original Query</h3>
   â”‚     â”‚  â”‚  â””â”€ <button class="copy-btn">
   â”‚     â”‚  â””â”€ .sql-code-wrapper
   â”‚     â”‚     â””â”€ <pre class="line-numbers">
   â”‚     â”‚        â””â”€ <code class="language-sql">
   â”‚     â”‚
   â”‚     â”œâ”€ .results__section (Optimization Rationale)
   â”‚     â”‚  â”œâ”€ .results__section-header
   â”‚     â”‚  â”œâ”€ .performance-metrics
   â”‚     â”‚  â”‚  â””â”€ .metrics-grid
   â”‚     â”‚  â”‚     â””â”€ .metric-card (Ã—4)
   â”‚     â”‚  â””â”€ .bullet-list
   â”‚     â”‚     â””â”€ .bullet-item (Ã—N)
   â”‚     â”‚
   â”‚     â”œâ”€ .results__section (Validation Report)
   â”‚     â”‚  â”œâ”€ .results__section-header
   â”‚     â”‚  â””â”€ .text-block
   â”‚     â”‚
   â”‚     â”œâ”€ .results__section (Cost Estimation)
   â”‚     â”‚  â”œâ”€ .results__section-header
   â”‚     â”‚  â””â”€ .text-block
   â”‚     â”‚
   â”‚     â””â”€ .results__section (Schema Suggestions)
   â”‚        â”œâ”€ .results__section-header
   â”‚        â””â”€ .text-block
   â”‚
   â”œâ”€ .footer
   â”‚  â””â”€ .footer-content
   â”‚     â”œâ”€ <p>âš¡ Powered by Claude AI</p>
   â”‚     â””â”€ .footer-stats
   â”‚        â”œâ”€ <span>Lightning Fast</span>
   â”‚        â”œâ”€ <span>Secure</span>
   â”‚        â””â”€ <span>AI-Powered</span>
   â”‚
   â””â”€ <scripts>
      â”œâ”€ <script src="prism.min.js">
      â”œâ”€ <script src="prism-sql.min.js">
      â”œâ”€ <script src="prism-line-numbers.min.js">
      â””â”€ <script src="script.js">
```

---

*Architecture Diagram - Last Updated: January 2024*
*For implementation details, see [Complete Project Documentation](COMPLETE_PROJECT_DOCUMENTATION.md)*